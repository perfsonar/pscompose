<!doctype html>
<html>
    <head>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
          href="/css/google-fonts-signika-and-source-sans.css"
          rel="stylesheet"
        />
        <!-- psCompose -->
        <link rel="stylesheet" href="/css/pscompose.css" />

        <!-- Lucide Icon Library -->
        <script src="/lib/lucide.min.js@0.479.0" type="text/javascript"></script>

        <!-- HTMX Library -->
        <script src="/lib/htmx.org@2.0.4"></script>
        <script src="/lib/client-side-templates.min.js@2.0.4"></script>
        <script src="/lib/nunjucks.min.js@3.2.4"></script>

        <!-- JSON Forms Web Component Library -->
        <script src='https://unpkg.com/jsonforms-esm@3.5.1-beta1/dist/jsonforms.esm.js' type="module"></script>

        <!-- Web Components -->
        <script src='/components/web-button.js' type="module"></script>
        <script src='/components/text-input.js' type="module"></script>
        <script src='/components/text-input-area.js' type="module"></script>
        <script src='/components/dropdown-list.js' type="module"></script>
        <script src='/components/switch.js' type="module"></script>
        <script src='/components/checkbox.js' type="module"></script>

        <script>
            document.addEventListener('htmx:afterRequest', function(evt) {
                lucide.createIcons();
            });
            // probably we'll need something like this too:
            /*document.addEventListener("htmx:beforeRequest", function(outboundReq){
                outboundReq.headers.push(["my auth header"])
            })*/
        </script>
    </head>
    <body class="packets-ui" hx-ext="client-side-templates">
        <div class="bg-surface-bg">
            <nav hx-get="/partials/top_nav.html" hx-trigger="load">
            </nav>
            <div class="backdrop">
                <nav hx-get="/partials/left_nav.html" hx-trigger="load">
                </nav>
                <main id='page-content'>

                    <div id='router-target' class="page">
                    </div>

                </main>
            </div>
        </div>
        <script>
            // the actual URL router
            function urlRouter(path){
                path = path.replace("/app", "");
                if (path == "/"){
                    return "/pages/index.html";
                }
                window.psCompose = {
                    "activeSection": null
                }
                psCompose.activeSection = path.split("/")[1];
                return `/pages/${psCompose.activeSection}/${psCompose.activeSection}.html`;
            }

            let target = document.getElementById("router-target");

            target.innerHTML = `<div
                hx-get='${urlRouter(window.location.pathname)}'
                hx-trigger='load'>
            </div>`;
        </script>
    </body>
    </html>
